<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ja" lang="ja">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta http-equiv="Content-Style-Type" content="text/css" />
	<meta http-equiv="Content-Script-Type" content="text/javascript" />
	<meta http-equiv="imagetoolbar" content="no" />
	<meta name="description" content="" />
	<meta name="keywords" content="" />
	<link rel="stylesheet" href="../../css/common.css" type="text/css" />
	<link type="text/css" rel="stylesheet" href="../../css/styles/shCoreDefault.css"/>
	<script type="text/javascript" src="../../css/scripts/shCore.js"></script>
	<script type="text/javascript" src="../../css/scripts/shBrushBash.js"></script>
	<script type="text/javascript">SyntaxHighlighter.all();</script>
	<title>Octaveのインストール(BLAS,LAPACKの組み込み)</title>
	<!-- google analityics -->
	<script type="text/javascript">
	  var _gaq = _gaq || [];
	  _gaq.push(['_setAccount', 'UA-35918686-1']);
	  _gaq.push(['_trackPageview']);
	  (function() {
		var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
		ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
		var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
	  })();
	</script>
	<!-- google analityics end -->
</head>
<body>
<div id="top">
   <div id="contents">
		<h2>Octaveのインストール(BLAS,LAPACKの組み込み) (<a href="../../dev_tips.html">全体の目次に戻る</a>)</h2>
ここでは、MATLABの互換ソフトであるOctaveをソースコードからコンパイルします．
また、<a href="tune_atlas.html">前節</a>で紹介した最適化済みのBLASとLAPACKを組み込みます．

<br/>基本的な作業内容は、Octaveのコンパイル時にオプションとして最適化済みの BLAS と LAPACK を指定するだけです．
以下にシェルスクリプトの一例を示します．
<pre class="brush: bash;">
#!/bin/bash

# ATLASがインストールされているディレクトリ
ATLAS_IDIR=/usr/local/lib/atlas

# ビルドディレクトリ
BUILD_DIR=~/_build_dir_

# OCTAVEのバージョン
OCT_VER=4.0.0

######### このセクションはお使いの環境に応じて実行して下さい

# sudo apt-get update
# sudo apt-get upgrade

# g++, gnuplot のインストール
# sudo apt-get -yV install g++ gfortran gnuplot-x11

# コンパイルのデフォルト設定において、必須の各種ライブラリのインストール
# sudo apt-get -yV install libpcre3 libpcre3-dev
# sudo apt-get -yV install libreadline6 libreadline6-dev

# オプションのライブラリ
# sudo apt-get -yV install libfftw3-3 libfftw3-dev

#########

# Octaveソースファイルのダウンロードと作業ディレクトリの作成
mkdir "${BUILD_DIR}/"
cd "${BUILD_DIR}/"
if [ ! -f octave-${OCT_VER}.tar.gz ]; then 
  wget "ftp://ftp.gnu.org/gnu/octave/octave-${OCT_VER}.tar.gz"
fi
rm -Rf "octave-${OCT_VER}/"
tar -xvzf "octave-${OCT_VER}.tar.gz"

#########

cd "${BUILD_DIR}/octave-${OCT_VER}"

# コンパイラオプションの設定
OPTION_OCTAVE="-I${ATLAS_IDIR}/include -O3 -march=native -fopenmp -lgomp -lpthread -lgfortran"

# ビルドの設定
CC=gcc CXX=g++ F77=gfortran CFLAGS="${OPTION_OCTAVE}" CPPFLAGS="${OPTION_OCTAVE}" FFLAGS="${OPTION_OCTAVE}" F77FLAGS="${OPTION_OCTAVE}" LDFLAGS="-L${ATLAS_IDIR}/lib" ./configure --enable-static --enable-shared --with-blas="-Wl,-rpath=${ATLAS_IDIR}/lib -lptcblas_ATLAS -lptf77blas_ATLAS -latlas_ATLAS" --with-lapack="-Wl,-rpath=${ATLAS_IDIR}/lib -llapack_ATLAS -lptcblas_ATLAS -lptf77blas_ATLAS -latlas_ATLAS"

# ビルド開始
make -j 4
make check
sudo make uninstall
sudo make install
</pre>

  </div><!-- /#contents-->
</div><!-- /#top-->
</body>
</html>
